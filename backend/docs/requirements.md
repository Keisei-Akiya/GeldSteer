# 要件定義書：資産運命統制システム「Geld;Steer」

## 1. コンセプト：THE CONCEPT

「投資の荒波という不確定要素（世界線）に対し、論理的帰結に基づいた舵取り（Steer）を行う」
本システムは、分散投資におけるアセットアロケーションを最適化し、リスク・リターンの観測と制御を目的とする。

## 2. 主要機能：CORE MISSIONS

### 2.1 資産観測（Monitoring）

- **銘柄ポートフォリオ登録**:
  - 各銘柄の名称、現在評価額（Decimal精度）、目標構成比率を保持。
- **乖離率の可視化**:
  - 現状の構成比率と理想の比率を比較し、リバランスが必要な「歪み」を特定する。

### 2.2 運命統制（Steer / Rebalance）

- **最適追加購入シミュレーション**:
  - 任意額の資金を追加投入する際、どの銘柄にいくら配分すれば目標比率に最も近づくかを算出。
- **フルリバランス算出**:
  - 現在の資産総額を維持したまま、売買によって目標比率を完全再現するための各銘柄の売買金額を提示。

### 2.3 未来予測（Simulation）

- **期待リターン・リスク計算**:
  - 各アセットクラスの期待収益率と標準偏差を入力値とし、ポートフォリオ全体の期待値を算出。
- **モンテカルロ・シミュレーション**:
  - 乱数を用いた数千回の試行により、将来的な資産推移の確率分布を「観測」する。

## 3. 技術仕様：TECHNICAL SPECIFICATIONS

「Geld;Steer」は、計算の正確性とシステムの堅牢性を担保するため、以下のスタックを採用する。

- **Core Engine**: Rust (Edition 2021)
- **Calculation**: `rust_decimal` (浮動小数点誤差を排除した厳密な通貨計算)
- **Data Store**: SQLite / `sqlx` (ローカル完結型データベースによるプライバシー保護)
- **Architecture**: ドメイン駆動設計を意識したモジュール構成
- **System Interface**: CLI (初期) / REST API (拡張)

## 4. データモデル：DATA STRUCTURE

### Asset (資産情報)

| フィールド | 型 | 説明 |
| :--- | :--- | :--- |
| `id` | UUID / Integer | 内部識別子 |
| `name` | String | 銘柄名 |
| `amount` | Decimal | 現在の評価額（日本円など） |
| `target_ratio` | Decimal | 目標とする構成比率（%） |

## 5. 非機能要件：NON-FUNCTIONAL REQUIREMENTS

- **高精度**: 通貨計算において `0.0000000001` の誤差も許容しない。
- **秘匿性**: 個人の資産情報は「観測者（ユーザー）」のローカル環境外へ一切送信しない。
- **高速応答**: 大規模なシミュレーションにおいても、Rustの並列処理（Rayon等）を活用し瞬時に結果を返す。

## 6. ロードマップ：TIMELINE

1. **Phase 1 "First Steer"**: CLI上での基本的なリバランス計算の実装。
2. **Phase 2 "Data Record"**: SQLiteを用いた資産情報の永続化。
3. **Phase 3 "Future View"**: モンテカルロ法による将来予測機能の追加。
4. **Phase 4 "Integrated Interface"**: Web UI（Frontend）との統合。
