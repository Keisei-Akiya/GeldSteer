# ファイル・ディレクトリ構成ガイドライン

このドキュメントでは、GeldSteer バックエンドプロジェクトにおけるファイルおよびディレクトリの構成ルールを定義します。

## ディレクトリ構造

- `src/core/`: ドメインや共通ユーティリティに依存しない、基盤となる重要なインフラストラクチャやコアロジック。
  - 例: データベース接続プール、カスタムエラー型 (`AppError`)。
- `src/domains/`: ドメイン固有のロジック。各サブディレクトリは機能的なドメイン（例: `portfolio`, `accounts`, `catalog`）を表します。
- `src/shared/`: 複数のドメイン間で共有されるユーティリティやロジック。
  - `src/shared/util/`: ドメイン固有のビジネスロジックには依存しないが、アプリケーション全体で有用な汎用ヘルパー関数。
  - `src/shared/validation/`: 共有されるバリデーションロジックやカスタムバリデーター。
- `src/middleware/`: リクエスト/レスポンス処理のためのグローバルまたは特定のミドルウェア。

## ドメイン内のファイル構成

各ドメイン（`src/domains/*/`）内は、以下の役割に基づいてファイルを分割し、**モデル（エンティティ）ごとに構造体を作成して `impl` ブロックでメソッドをまとめます。**

### 各ファイルの役割

- `mod.rs`: ドメインのモジュール定義。ルート定義（Router）やドメイン固有の公開設定を記述します。
- `handler.rs`: HTTPリクエストの受付とレスポンスの返却を担当（コントローラー層）。モデルごとに `XXXHandler` 構造体を定義します。
- `service.rs`: 業務ロジックを記述。モデルごとに `XXXService` 構造体を定義します。
- `repository.rs`: データベース操作を担当。モデルごとに `XXXRepository` 構造体を定義します。
- `model.rs`: データベースのテーブルに対応する構造体を定義します。
- `schema.rs`: APIの入出力に使用するデータ構造（DTO）を定義します。

### 実装ルール

1. **モデルごとの分割**: ドメイン内で一つの Handler/Service/Repository にまとめず、`model.rs` で定義された主要なエンティティごとに構造体を分けて実装してください。
    - 例: `AssetCategoryHandler`, `AssetGroupingHandler`, `AssetHandler`
2. **静的メソッドの利用**: 現在の設計では、各構造体のメソッドは `pub async fn` による **static メソッド（関連関数）** として実装します。
3. **汎用的な命名**: 構造体レベルでコンテキストが明確なため、メソッド名はシンプルに保ってください。
    - 例: `AssetService::create_asset` ではなく `AssetService::create`

## 開発ルール

- **共通ロジックの共通化 (DRY)**: 特定の関数（ヘッダーの抽出など）が複数のドメインで使用される場合は、一方のドメインからインポートしたり重複させたりせず、`src/shared/` に移動してください。
- **明確なドメイン境界**: 各ドメインは可能な限り疎結合に保ってください。共通機能は `src/shared` を介して提供します。
- **薄いハンドラー**: `handler.rs` は薄く保ち、ロジックは `service.rs` に記述してください。
- **バリデーション**: 入力値の検証は `handler.rs` で `schema.rs` に定義した Struct に対して実施します。
