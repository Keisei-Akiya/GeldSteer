# ファイル・ディレクトリ構成ガイドライン

このドキュメントでは、GeldSteer バックエンドプロジェクトにおけるファイルおよびディレクトリの構成ルールを定義します。

## ディレクトリ構造

- `src/core/`: ドメインや共通ユーティリティに依存しない、基盤となる重要なインフラストラクチャやコアロジック。
  - 例: データベース接続プール、カスタムエラー型 (`AppError`)。
- `src/domains/`: ドメイン固有のロジック。各サブディレクトリは機能的なドメイン（例: `portfolio`, `accounts`, `catalog`）を表します。
- `src/shared/`: 複数のドメイン間で共有されるユーティリティやロジック。
  - `src/shared/util/`: ドメイン固有のビジネスロジックには依存しないが、アプリケーション全体で有用な汎用ヘルパー関数。
  - `src/shared/validation/`: 共有されるバリデーションロジックやカスタムバリデーター。
- `src/middleware/`: リクエスト/レスポンス処理のためのグローバルまたは特定のミドルウェア。

## ドメイン内のファイル構成

各ドメイン（`src/domains/*/`）内は、以下の役割に基づいてファイルを分割します。

- `mod.rs`: ドメインのモジュール定義。ルート定義（Router）やドメイン固有の公開設定を記述します。
- `handler.rs`: HTTPリクエストの受付とレスポンスの返却を担当します（コントローラー層）。リクエストパラメータの抽出、バリデーション呼び出し、サービス層の実行、ステータスコードの制御を行います。
- `service.rs`: 業務ロジック（ビジネスロジック）を記述します。複数のリポジトリの組み合わせや、複雑な計算、ドメインルールを実装します。
- `repository.rs`: データベース操作を担当します（データアクセス層）。SQLの発行やクエリビルダ（SeaORM等）を使用したデータの保存・取得を行います。
- `model.rs`: データベースのテーブル構造に対応するエンティティ（Struct）を定義します。
- `schema.rs`: APIの入出力に使用するデータ構造（DTO）を定義します。リクエストボディやレスポンスJSONの形式を管理します。

## 開発ルール

- **共通ロジックの共通化 (DRY)**: 特定の関数（ヘッダーの抽出など）が複数のドメインで使用される場合は、一方のドメインからインポートしたり重複させたりせず、`src/shared/` に移動してください。
- **明確なドメイン境界**: 各ドメインは可能な限り疎結合に保ってください。共通機能は `src/shared` を介して提供します。
- **Axum ハンドラー**: `handler.rs` は薄く保ち、ロジックは `service.rs` に記述してください。
- **バリデーション**: 入力値の検証は `handler.rs` で `schema.rs` に定義した Struct に対して実施します。
